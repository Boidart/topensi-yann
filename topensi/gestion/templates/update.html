{% load static %}

<!-- Application pour lister les postes chez Topensi -->
<!DOCTYPE html>
<html>
<head>  
    <meta charset="UTF-8">
    <title>Topensi - {% block title %}Accueil{% endblock %}</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
</head>
<body>

    <!-- Header -->
    {% include 'layouts/header.html' %}

    <!-- Contenu -->
    <main role="main" class="container">
        <table class="table table-bordered mt-4">
            <thead><br>
              <tr>
                <th scope="col">Client</th>
                <th scope="col">Partnaire</th>
                <th scope="col">Type</th>
                <th scope="col">Marge</th>
                <th scope="col">Récurrent</th>
                <th scope="col">Etat</th>
                <th scope="col">Facturé</th>
                <th scope="col">Date création</th>
                <th scope="col">Date cloture</th>
              </tr>
            </thead>
            <tbody>
                {% for e in info %}
                <tr>
                {% for cli in client %}
                    {% if cli.id == e.cli_id %}
                        <td class="client_td">{{cli.nom}}</td>
                    {% endif %}
                {% endfor %}
                {% for part in partenaire %}
                    {% if part.id == e.partenaire_id %}
                        <td class="partenaire_td">{{part.nom}}</td>
                    {% endif %}
                {% endfor %}
                {% for typ in type %}
                    {% if typ.id == e.typ_id %}
                        <td class="type_td">{{typ.nom}}</td>
                    {% endif %}
                {% endfor %}
                    <td>{{ e.marge }}</td>
                    <td>{{ e.recurrent }}</td>
                {% for etat in etat %}
                    {% if etat.id == e.etat_id %}
                        <td class="etat_td">{{etat.nom}}</td>
                    {% endif %}
                {% endfor %}
                    <td>{{ e.facture }}</td>
                    <td>{{ e.dateCreation }}</td>
                    <td>{{ e.dateCloture }}</td>
                    <td><button type="submit" form="form-maj{{e.id}}" class="btn btn-secondary modifier">Modifier</button></td></form>
                    <td><button type="submit" form="form-del{{e.id}}" class="btn btn-danger">Supprimer</button></td>
                </tr>
            {% endfor %}
            </tbody>
          </table>
          <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
          <script>
    $(".modifier").click(function() {
        id = $(this).attr('form')
        $(this).parent().parent().eq(0).find("td").each(function(x,cpt){
            if(x == 0){
                before = $(this).text()
                $(this).html('<select style="width : 100%;" class="custom-select"  form="'+id+'" name="client"><option>Selectionnez le client</option>{% for e in client %}<option>{{e.nom}}</option>{% endfor %}</select>')
                $(this).find("option").each(function(){
                    if($(this).text() == before){
                        $(this).prop("selected", "selected")
                    }
                })
            } else if(x == 1){
                before = $(this).text()
                $(this).html('<select style="width : 100%;" class="custom-select"  form="'+id+'" name="partenaire"><option>Selectionnez le partenaire</option>{% for e in partenaire %}<option>{{e.nom}}</option>{% endfor %}</select>')
                $(this).find("option").each(function(){
                    if($(this).text() == before){
                        $(this).prop("selected", "selected")
                    }
                })
            } else if(x == 2){
                before = $(this).text()
                $(this).html('<select style="width : 100%;" class="custom-select"  form="'+id+'" name="type"><option>Selectionnez le type</option>{% for e in type %}<option>{{e.nom}}</option>{% endfor %}</select>')
                $(this).find("option").each(function(){
                    if($(this).text() == before){
                        $(this).prop("selected", "selected")
                    }
                })
            } else if(x == 3){
                $(this).html("<input style='width : 100%;' type='text' form='"+id+"' name='marge' value ='"+$(this).text()+"'/>")
            } else if(x == 4){
                $(this).html("<input style='width : 100%;' type='text' form='"+id+"' name='recurrent' value ='"+$(this).text()+"'/>")
            } else if(x == 5){
                before = $(this).text()
                $(this).html('<select style="width : 100%;" class="custom-select"  form="'+id+'" name="etat"><option>Selectionnez état</option>{% for e in etat %}<option>{{e.nom}}</option>{% endfor %}</select>')
                $(this).find("option").each(function(){
                    if($(this).text() == before){
                        $(this).prop("selected", "selected")
                    }
                })
            } else if(x == 6){
                before = $(this).text()
                $(this).html('<select style="width : 100%;"class="custom-select"  form="'+id+'" name="etat"><option>Selectionnez état</option>{% for e in info %}<option>{{e.facture}}</option>{% endfor %}</select>')
                $(this).find("option").each(function(){
                    if($(this).text() == before){
                        $(this).prop("selected", "selected")
                    }
                })
            } else if(x == 7){
                $(this).html("<input style='width : 100%;' type='date' form='"+id+"' name='datecreation' value ='"+$(this).text()+"'/>")
            } else if(x == 8){
                $(this).html("<input style='width : 100%;' type='date' form='"+id+"' name='datecloture' value ='"+$(this).text()+"'/>")
            } else if(x == 9){
                idform = id.replace("form-maj","")
                $(this).html('<input type="hidden" form="'+id+'" name="formid" value="'+idform+'" /> <button type="submit" form="'+id+'" class="btn btn-success mt-2 my-sm-0">Valider</button>')
            }
        })
      });
    </script>
    </main>
    <!-- Footer -->
    {% include 'layouts/footer.html' %}